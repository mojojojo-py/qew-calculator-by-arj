<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>90K Ultra Run Calculator</title>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <style>
    :root{--p:#2563eb;--s:#10b981;--g:#6b7280;--d:#ef4444}
    body{font-family:Segoe UI,sans-serif;background:#f3f4f6;margin:0;padding:20px;color:#1f2937}
    .c{max-width:900px;margin:auto;background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,.1);overflow:hidden;position:relative}
    header{background:var(--p);color:#fff;padding:1.5rem;text-align:center;position:relative}
    h1{margin:0;font-size:1.8rem}
    .i{font-size:.9rem;opacity:.9;margin-top:.5rem}
    .n{padding:2rem}
    .g{margin-bottom:1.2rem}
    label{display:block;margin-bottom:.4rem;font-weight:600;color:var(--g);font-size:0.95rem}
    input{border:1px solid #d1d5db;border-radius:8px;font-size:1rem;box-sizing:border-box}
    input.e{border-color:var(--d)}
    button{background:var(--p);color:#fff;border:none;padding:.75rem 1.5rem;border-radius:8px;font-size:1rem;cursor:pointer;margin-top:1rem;width:100%}
    button:hover{background:#1d4ed8}
    .share-btn{background:#10b981;color:#fff;margin-top:.5rem}
    .share-btn:hover{background:#059669}
    table{width:100%;border-collapse:collapse;margin-top:1.5rem;font-size:1rem;min-width:700px}
    th{background:#f8fafc;padding:.8rem;text-align:left;border-bottom:2px solid #e5e7eb;color:var(--g);font-weight:600}
    td{padding:.8rem;border-bottom:1px solid #e5e7eb;font-size:0.95rem}
    tr:hover{background:#f9fafb}
    .h{font-weight:bold;color:var(--s)}
    .t{background:#ecfdf5;font-weight:bold}
    .total-left{text-align:left}
    .total-center{text-align:center}
    .total-right{text-align:right}
    .o{font-size:.85rem;color:var(--g);margin-top:1rem}
    .lang-switch{position:absolute;top:10px;right:10px;font-size:0.9rem;z-index:10}
    .lang-switch a{color:#fff;text-decoration:underline;cursor:pointer;margin:0 5px;font-weight:600}
    .lang-switch a.active{color:#fbbf24}

    .input-row{display:flex;gap:1.5rem;align-items:flex-end;margin-bottom:1.8rem;flex-wrap:wrap}
    .input-group{flex:1;min-width:220px;display:flex;flex-direction:column}
    .input-group label{margin-bottom:0.35rem}

    .pace-row{display:flex;gap:0.5rem;align-items:center}
    .pace-input{flex:1;padding:0.65rem 0.8rem;font-size:0.95rem}
    .unit-box{width:90px;padding:0.65rem 0.8rem;font-size:0.85rem;background:#f3f4f6;border:1px solid #d1d5db;text-align:center;color:#6b7280}

    .result-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;padding:0 8px;font-weight:600}
    .team-name{color:var(--p);font-size:1.25rem;font-weight:700}
    .by-arj{font-size:0.9rem;color:#4b5563;text-align:right;line-height:1.3}

    /* CAPTURE AREA */
    #capture-area{
      padding:15px;
      background:#fff;
      border:1px solid #e5e7eb;
      border-radius:10px;
      box-shadow:0 2px 8px rgba(0,0,0,.05);
      overflow-x:auto;
      -webkit-overflow-scrolling:touch;
      max-width:100%
    }

    @media(max-width:600px){
      .n{padding:1.2rem}
      td,th{padding:.5rem;font-size:0.85rem}
      .input-row{flex-direction:column;gap:1rem}
      .input-group{min-width:100%}
      .pace-row{gap:0.4rem}
      .pace-input{padding:0.6rem 0.7rem;font-size:0.9rem}
      .unit-box{width:80px;padding:0.6rem 0.7rem;font-size:0.8rem}
      .result-header{flex-direction:column;text-align:center;gap:.4rem}
      .team-name{font-size:1.15rem}
      .by-arj{font-size:0.85rem}
      .t{font-size:0.85rem}
      .total-center,.total-right{font-size:0.85rem}
      table{min-width:650px}
    }
  </style>
</head>
<body>

<div class="c">
  <div class="lang-switch">
    <span data-lang="ina" class="lang-link active" onclick="setLang('ina')">INA</span> |
    <span data-lang="eng" class="lang-link" onclick="setLang('eng')">ENG</span>
  </div>

  <header>
    <h1 data-ina="90K Ultra Run Calculator" data-eng="90K Ultra Run Calculator">90K Ultra Run Calculator</h1>
    <div class="i" data-ina="Estimasi Waktu Pelari by ARJ (21Runners Qatar)" data-eng="Runner Time Estimator by ARJ (21Runners Qatar)">
      Estimasi Waktu Pelari by ARJ (21Runners Qatar)
    </div>
  </header>

  <div class="n">
    <div class="input-row">
      <div class="input-group">
        <label data-ina="Nama Team" data-eng="Team Name">Nama Team</label>
        <input id="teamName" type="text" inputmode="text" placeholder="Masukkan nama tim" class="pace-input">
      </div>
      <div class="input-group">
        <label data-ina="Waktu Mulai (HH:MM)" data-eng="Start Time (HH:MM)">Waktu Mulai (HH:MM)</label>
        <input id="s" type="text" inputmode="numeric" pattern="[0-9]*" value="05:00" placeholder="05:00" class="pace-input">
      </div>
    </div>

    <div class="g">
      <label data-ina="Pelari & Pace (mm:ss)" data-eng="Runner & Pace (mm:ss)">Pelari & Pace (mm:ss)</label>
      <div id="r"></div>
    </div>

    <button onclick="calculate()" data-ina="Hitung Estimasi Waktu" data-eng="Calculate Estimated Time">
      Hitung Estimasi Waktu
    </button>
    <button onclick="shareResult()" class="share-btn" data-ina="Bagikan Hasil (Gambar)" data-eng="Share Result (Image)" style="display:none" id="shareBtn">
      Bagikan Hasil (Gambar)
    </button>

    <div class="o" data-ina="Contoh: 5:30" data-eng="Example: 5:30">
      Contoh: 5:30
    </div>
    <div class="o" style="color:#dc2626;font-weight:600" data-ina="Kode: oleh ARJ" data-eng="Code: by ARJ">
      Kode: oleh ARJ
    </div>

    <div id="result-container" style="margin-top:20px"></div>
  </div>
</div>

<script>
// === DATA ===
const distances = [10.7, 22.5, 14.9, 14.3, 14.6, 13];
const runnersINA = ["Pelari 1", "Pelari 2", "Pelari 3", "Pelari 4", "Pelari 5", "Pelari 6"];
const runnersENG = ["Runner 1", "Runner 2", "Runner 3", "Runner 4", "Runner 5", "Runner 6"];
let currentLang = 'ina';

// === INIT PELARI ===
function initRunners() {
  const container = document.getElementById("r");
  container.innerHTML = '';
  const runners = currentLang === 'ina' ? runnersINA : runnersENG;
  const unit = currentLang === 'ina' ? 'menit:detik/km' : 'min:sec/km';
  const teamPlaceholder = currentLang === 'ina' ? 'Masukkan nama tim' : 'Type Team Name';
  document.getElementById("teamName").placeholder = teamPlaceholder;

  runners.forEach((name, i) => {
    const div = document.createElement("div");
    div.className = "g";
    div.innerHTML = `
      <label>${name} - Leg ${i+1} (${distances[i]} km)</label>
      <div class="pace-row">
        <input id="p${i}" type="text" inputmode="numeric" pattern="[0-9:]*" placeholder="5:30" class="pi pace-input">
        <div class="unit-box">${unit}</div>
      </div>
    `;
    container.appendChild(div);
  });
}

// === GANTI BAHASA ===
function setLang(lang) {
  if (lang === currentLang) return;
  currentLang = lang;
  document.querySelectorAll('[data-ina]').forEach(el => el.textContent = el.getAttribute(`data-${lang}`));
  document.querySelectorAll('[data-eng]').forEach(el => { if (!el.getAttribute('data-ina')) el.textContent = el.getAttribute(`data-${lang}`); });
  document.querySelectorAll('.lang-link').forEach(link => link.classList.toggle('active', link.getAttribute('data-lang') === lang));
  initRunners();
  document.getElementById("shareBtn").style.display = document.getElementById("result-container").innerHTML ? 'block' : 'none';
}

// === FORMAT PACE MM:SS ===
function formatPace(minutes) {
  const m = Math.floor(minutes);
  const s = Math.round((minutes - m) * 60);
  return `${m}:${s.toString().padStart(2, '0')}`;
}

// === HITUNG ===
function calculate() {
  document.querySelectorAll('.pi').forEach(i => i.classList.remove('e'));
  const startInput = document.getElementById("s").value.trim();
  if (!/^(\d{1,2}):(\d{2})$/.test(startInput)) {
    alert(currentLang === 'ina' ? "Format HH:MM salah!" : "Invalid HH:MM!");
    return;
  }

  const teamName = document.getElementById("teamName").value.trim() || (currentLang === 'ina' ? 'Tim' : 'Team');
  const [sh, sm] = startInput.split(":").map(Number);
  let currentMinutes = sh * 60 + sm;

  let html = `<div class="result-header">
    <div class="team-name">${teamName}</div>
    <div class="by-arj">${currentLang === 'ina' ? 'Estimasi Waktu Pelari by ARJ (21Runners Qatar)' : 'Runner Time Estimator by ARJ (21Runners Qatar)'}</div>
  </div>`;

  html += `<table><tr>
    <th>${currentLang==='ina'?'Pelari':'Runner'}</th>
    <th>${currentLang==='ina'?'Jarak':'Distance'}</th>
    <th>Pace</th>
    <th>${currentLang==='ina'?'Durasi':'Duration'}</th>
    <th>${currentLang==='ina'?'Mulai':'Start'}</th>
    <th>${currentLang==='ina'?'Selesai':'Finish'}</th>
  </tr>`;

  let totalMinutes = 0;
  let totalPaceMinutes = 0;
  let valid = true;

  for (let i = 0; i < 6; i++) {
    const paceInput = document.getElementById(`p${i}`).value.trim();
    const pace = parsePace(paceInput);
    if (!pace) { document.getElementById(`p${i}`).classList.add('e'); valid = false; continue; }
    const dist = distances[i], duration = pace * dist;
    totalMinutes += duration;
    totalPaceMinutes += pace * dist;
    const start = currentMinutes, finish = start + duration;
    html += `<tr>
      <td>${currentLang==='ina'?runnersINA[i]:runnersENG[i]}</td>
      <td>${dist} km</td>
      <td>${paceInput}/km</td>
      <td>${formatDuration(duration)}</td>
      <td>${formatTime(start)}</td>
      <td class="h">${formatTime(finish)}</td>
    </tr>`;
    currentMinutes = finish;
  }

  if (!valid) { alert(currentLang === 'ina' ? "Pace salah!" : "Invalid pace!"); return; }

  const totalHours = Math.floor(totalMinutes / 60), totalMins = Math.round(totalMinutes % 60);
  const finalTime = formatTime(sh * 60 + sm + totalMinutes);
  const hourLabel = currentLang === 'ina' ? 'j' : 'h';

  const avgPace = totalPaceMinutes / 90;
  const avgPaceStr = formatPace(avgPace) + '/km';

  html += `<tr class="t">
    <td colspan="2" class="total-left"><strong>Total: 90 km</strong></td>
	<td class="total-center"><strong>${avgPaceStr}</strong></td>
    <td class="total-center"><strong>${totalHours}${hourLabel} ${totalMins}m</strong></td>
    <td colspan="2" class="total-right"><strong>${currentLang==='ina'?'Selesai':'Finish'}: ${finalTime}</strong></td>
  </tr></table>`;

  const container = document.getElementById("result-container");
  container.innerHTML = `<div id="capture-area">${html}</div>`;
  document.getElementById("shareBtn").style.display = "block";
}

function parsePace(t) {
  const match = t.trim().match(/^(\d+):(\d{2})$/);
  if (!match) return null;
  const m = parseInt(match[1], 10), s = parseInt(match[2], 10);
  return s >= 60 || m < 0 ? null : m + s/60;
}

function formatTime(m) {
  const total = m % 1440;
  const h = Math.floor(total / 60).toString().padStart(2, '0');
  const min = Math.floor(total % 60).toString().padStart(2, '0');
  return `${h}:${min}`;
}

function formatDuration(m) {
  const h = Math.floor(m / 60), min = Math.floor(m % 60);
  const hourLabel = currentLang === 'ina' ? 'j' : 'h';
  const minLabel = currentLang === 'ina' ? 'menit' : 'min';
  return h > 0 ? `${h}${hourLabel} ${min}m` : `${min} ${minLabel}`;
}

// === SHARE: FULL CAPTURE PAKSA LEBAR ===
function shareResult() {
  const area = document.getElementById("capture-area");
  
  // PAKSA LEBAR MINIMAL
  const originalOverflow = area.style.overflow;
  const originalWidth = area.style.width;
  area.style.overflow = 'visible';
  area.style.width = 'fit-content';
  area.style.minWidth = '700px';

  // TUNGGU RENDER
  setTimeout(() => {
    html2canvas(area, {
      scale: 2,
      backgroundColor: '#ffffff',
      logging: false,
      useCORS: true,
      width: area.scrollWidth,
      height: area.scrollHeight,
      scrollX: 0,
      scrollY: 0
    }).then(canvas => {
      canvas.toBlob(blob => {
        const teamName = document.getElementById("teamName").value.trim() || 'Team';
        const file = new File([blob], `QEW90K_${teamName.replace(/[^a-zA-Z0-9]/g,'_')}_${currentLang.toUpperCase()}.png`, { type: 'image/png' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = file.name; a.click();
        URL.revokeObjectURL(url);
        if (navigator.share && navigator.canShare({ files: [file] })) {
          navigator.share({ files: [file], title: 'QEW 90K Result', text: 'Hasil Ultra Run 90K' }).catch(() => {});
        }
      }, 'image/png', 0.9);
      
      // KEMBALIKAN STYLE
      area.style.overflow = originalOverflow;
      area.style.width = originalWidth;
    });
  }, 100);
}

// === INPUT FORMATTER ===
document.getElementById("r").addEventListener('input', e => {
  if (!e.target.classList.contains('pi')) return;
  let val = e.target.value.replace(/\D/g, '');
  if (val.length > 4) val = val.slice(0, 4);
  if (val.length >= 3) val = val.slice(0, -2) + ':' + val.slice(-2);
  e.target.value = val;
});

// === INIT ===
initRunners();
</script>

</body>
</html>
